<!DOCTYPE html>
<html>
<head>
    <title>RDH Editable Progress Note</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        #container {
            width: 210mm;
            height: 297mm;
            position: relative;
            margin: 0 auto;
            page-break-after: always;
        }
        img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* This ensures the image fits within the container without distortion */
        }
        .editable-text {
            position: absolute;
            z-index: 10;
            background: transparent;
            border: none;
            outline: none;
            min-width: 20px;
            min-height: 20px;
            line-height: 1.23; /* Adjust this value as needed for line spacing */
            white-space: pre-wrap; /* Ensures that line breaks are respected */
        }
        @media print {
            body, html {
                width: 210mm;
                height: 297mm;
            }
            #container {
                page-break-before: always;
                page-break-inside: avoid;
                page-break-after: avoid;
            }
            img {
                max-width: 100%;
                max-height: 100%;
            }
            .editable-text {
                border: none;
                overflow: visible;
                word-wrap: break-word;
            }
        }
    </style>
</head>
<body>

<div id="container" onclick="placeInput(event)">
    <img src="1.png" alt="Form Image"/>
</div>

<button onclick="printPage()">Print</button>

<script>
function placeInput(event) {
    if (event.target.className === "editable-text") return; // Skip if clicking on an existing editable text

    const container = document.getElementById('container');

    // Calculate position relative to the container
    const x = event.pageX - container.offsetLeft;
    let y = event.pageY - container.offsetTop;

    // Assuming an average line height of about 20px. Adjust as needed.
    const lineHeightApprox = 20;

    // Shift the y position up by the approximate line height
    y -= lineHeightApprox;

    // Prevent the y position from being negative
    if (y < 0) y = 0;

    // Create the editable span
    const span = document.createElement("span");
    span.contentEditable = true;
    span.classList.add("editable-text");
    span.style.left = `${x}px`;
    span.style.top = `${y}px`;

    // Append and focus on the new span
    container.appendChild(span);
    span.focus();

    // Blur event to remove if empty or finalize text
    span.onblur = function() {
        if (!span.innerText.trim()) {
            span.remove(); // Remove span if it's empty
        }
    };

    // Handle keydown events for line breaks and preventing new lines
    span.onkeydown = function(event) {
        if (event.key === "Enter") {
            event.preventDefault(); // Prevent default Enter behavior
            document.execCommand('insertHTML', false, '<br><br>'); // Insert a double line break
        }
    };
}


function printPage() {
    document.querySelectorAll('.editable-text').forEach(function(span) {
        span.removeAttribute('contenteditable');
    });
    window.print();
    document.querySelectorAll('.editable-text').forEach(function(span) {
        span.setAttribute('contenteditable', true);
    });
}
</script>

</body>
</html>
